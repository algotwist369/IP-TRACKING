<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Tracking Example - Enhanced Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            background: #f4f4f4;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .section {
            background: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .info {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
        }
        .code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            overflow-x: auto;
        }
        .tracking-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Enhanced IP Tracking System</h1>
        <p>This page demonstrates the new session-based tracking system that prevents duplicate counting from page refreshes.</p>
    </div>

    <div class="section">
        <h2>üìä How the New System Works</h2>
        
        <div class="info">
            <h3>‚úÖ What Gets Tracked:</h3>
            <ul>
                <li><strong>External visits:</strong> From Google, social media, other websites</li>
                <li><strong>Direct visits:</strong> Typed URLs, bookmarks (no referrer)</li>
                <li><strong>New sessions:</strong> First visit from a user</li>
            </ul>
        </div>

        <div class="warning">
            <h3>‚ùå What Gets Ignored:</h3>
            <ul>
                <li><strong>Page refreshes:</strong> F5, Ctrl+R, browser refresh</li>
                <li><strong>Internal navigation:</strong> Links within the same website</li>
                <li><strong>Same session visits:</strong> Multiple pages within 30 minutes</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>üß™ Testing the Tracking System</h2>
        
        <div class="tracking-info">
            <h3>Current Session Info:</h3>
            <div id="sessionInfo">Loading...</div>
        </div>

        <button class="button" onclick="testTracking()">üîÑ Test Manual Tracking</button>
        <button class="button" onclick="showSessionInfo()">üìã Show Session Details</button>
        <button class="button" onclick="simulateExternalVisit()">üåê Simulate External Visit</button>
        <button class="button" onclick="clearSession()">üóëÔ∏è Clear Session (New User)</button>
        
        <div id="testResults"></div>
    </div>

    <div class="section">
        <h2>üîó Test Internal Navigation</h2>
        <p>Click these links to test internal navigation (should NOT be tracked):</p>
        <a href="#section1" class="button">Go to Section 1</a>
        <a href="#section2" class="button">Go to Section 2</a>
        <a href="?test=internal" class="button">Add Query Parameter</a>
        
        <div id="section1" style="margin-top: 50px;">
            <h3>Section 1</h3>
            <p>This is section 1. Navigation here should not trigger new tracking.</p>
        </div>
        
        <div id="section2" style="margin-top: 50px;">
            <h3>Section 2</h3>
            <p>This is section 2. Navigation here should not trigger new tracking.</p>
        </div>
    </div>

    <div class="section">
        <h2>üìù Implementation Guide</h2>
        
        <h3>1. Include the Tracking Script:</h3>
        <div class="code">
&lt;script src="http://your-server.com/tracking-script.js"&gt;&lt;/script&gt;
        </div>

        <h3>2. Update Server URL:</h3>
        <div class="code">
// In tracking-script.js, change this line:
const TRACKING_SERVER = 'http://your-server.com:5000';
        </div>

        <h3>3. Manual Tracking (Optional):</h3>
        <div class="code">
// Track manually if needed
window.IPTracker.track();

// Check if should track
if (window.IPTracker.shouldTrack()) {
    window.IPTracker.track();
}
        </div>
    </div>

    <div class="section">
        <h2>üéØ Expected Behavior</h2>
        
        <div class="success">
            <h3>First Visit (New Session):</h3>
            <p>‚úÖ <strong>Tracked</strong> - Creates new session and records visit</p>
        </div>

        <div class="warning">
            <h3>Page Refresh (F5, Ctrl+R):</h3>
            <p>‚ùå <strong>Not Tracked</strong> - Same session, internal action</p>
        </div>

        <div class="warning">
            <h3>Internal Link Click:</h3>
            <p>‚ùå <strong>Not Tracked</strong> - Same domain navigation</p>
        </div>

        <div class="success">
            <h3>External Link Visit:</h3>
            <p>‚úÖ <strong>Tracked</strong> - Different referrer domain</p>
        </div>

        <div class="success">
            <h3>Return After 30+ Minutes:</h3>
            <p>‚úÖ <strong>Tracked</strong> - New session (old one expired)</p>
        </div>
    </div>

    <!-- Include the tracking script -->
    <script src="tracking-script.js"></script>
    
    <script>
        // Test functions
        function testTracking() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="info">Testing manual tracking...</div>';
            
            if (window.IPTracker) {
                window.IPTracker.track();
                results.innerHTML = '<div class="success">‚úÖ Manual tracking triggered! Check console for details.</div>';
            } else {
                results.innerHTML = '<div class="warning">‚ùå Tracking script not loaded!</div>';
            }
        }

        function showSessionInfo() {
            const sessionInfo = document.getElementById('sessionInfo');
            if (window.IPTracker) {
                const session = window.IPTracker.getSession();
                const data = window.IPTracker.collectData();
                
                sessionInfo.innerHTML = `
                    <strong>Session ID:</strong> ${session.sessionId}<br>
                    <strong>Visit Count:</strong> ${session.visitCount}<br>
                    <strong>Created:</strong> ${new Date(session.createdAt).toLocaleString()}<br>
                    <strong>Computer ID:</strong> ${data.computerId}<br>
                    <strong>Referrer:</strong> ${data.referer || 'None (Direct visit)'}<br>
                    <strong>Should Track:</strong> ${window.IPTracker.shouldTrack() ? 'Yes' : 'No'}
                `;
            } else {
                sessionInfo.innerHTML = '<div class="warning">Tracking script not loaded!</div>';
            }
        }

        function simulateExternalVisit() {
            // Simulate coming from Google
            Object.defineProperty(document, 'referrer', {
                value: 'https://www.google.com/search?q=test',
                writable: false
            });
            
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="info">Simulated external referrer. Refresh page to test external visit tracking.</div>';
        }

        function clearSession() {
            localStorage.removeItem('ip_tracking_session');
            localStorage.removeItem('ip_tracking_computer_id');
            
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="success">‚úÖ Session cleared! Next visit will be treated as new user.</div>';
            
            // Update session info
            setTimeout(showSessionInfo, 100);
        }

        // Show initial session info
        setTimeout(showSessionInfo, 1000);
    </script>
</body>
</html>
